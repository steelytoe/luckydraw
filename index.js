var express = require('express');
var app = express();
var server = require('http').Server(app);
var io = require('socket.io')(server);

server.listen(3333);
// WARNING: app.listen(80) will NOT work here!

/* Service node_modules static files */
app.use(express.static('assets'));
app.use(express.static('node_modules'));
app.use(express.static('libraries'));

app.get('/', function (req, res) {
	res.sendFile(__dirname + '/index.html');
});

app.get('/control', function (req, res) {
	res.sendFile(__dirname + '/control.html');
});
// var bibArray = ["1001","1002","1003","1004","1005","1006","1011","1007","1008","1009","1010","1012","1013","1014","1018","1015","5001","5002","1016","1017","1022","1019","1020","1021","1026","1023","1024","1025","2001","1032","1027","1033","1029","4001","4002","1028","1031","1030","1034","1035","5003","1038","1036","1037","1039","1040","1041","1042","1043","1044","1045","1046","4003","1047","1049","1048","1050","1051","5004","5005","1057","1056","1052","1053","5006","1054","1055","1059","2002","1060","1058","2003","1061","1062","1063","1064","4004","4005","1065","5007","1072","1066","1068","1067","1069","1076","1070","1073","1071","1075","1074","5008","4006","1193","1077","1078","1079","1080","1081","1082","1083","1084","1086","1085","1087","1088","1089","1090","1098","1091","1092","1099","1093","1095","1094","1109","2005","2004","1097","1096","1100","1103","1102","1104","1105","2006","2009","5010","2007","2008","5009","2012","1101","1112","2011","1113","4008","4009","1274","2010","1106","1107","1108","1115","1123","1344","1110","1111","1116","1117","1118","2013","1114","1152","1224","1119","1120","1121","1126","1127","1145","1128","1125","1147","1133","1122","1124","1129","1144","1132","1275","1149","4010","1157","1130","1131","5011","2014","1146","1148","1187","1150","1159","1151","1161","1276","2016","1154","1188","2018","2019","1198","1155","4014","4013","1164","1156","1200","1158","1165","2015","1160","2025","1241","1163","1162","2017","1242","1186","1197","5012","2020","1189","2021","1190","1191","1192","2023","1199","1281","1243","1194","1244","1195","4015","2022","1196","2024","1277","1278","1228","1229","1230","1231","1232","1233","1234","1235","1236","1237","1238","1239","1240","1223","1225","1227","1226","1284","1245","4016","1246","1279","1280","1283","1282","1327","2029","2027","2026","1317","1341","1342","1285","1286","1287","1325","1318","1343","1319","1315","1320","1321","1322","1311","2028","1323","1350","1312","1324","1316","2030","1326","5015","1375","1376","1377","5016"];
var bibArray = ["1001","1002","1003","1004","3002","3003","3004","3005","3006","3007","3008","3010","3011","3012","1008","3014","1010","3015","3017","3200","1011","1012","3018","3019","1013","1014","3020","3022","3024","3025","1015","5001","5002","3027","3028","1016","3029","3030","3032","3034","3035","3036","1020","3037","3038","3039","3040","3041","3042","3043","3044","3045","3046","3047","3048","3050","3051","3052","3053","3054","3055","3057","3058","3059","3060","3061","3062","3063","3064","3065","1021","3068","3069","3071","3072","1023","3073","3074","3075","3076","3077","3078","1026","3079","1027","3080","3081","3082","3083","3084","3086","3087","3088","3089","3090","3091","3092","3093","3094","3095","1029","1030","1031","2001","3096","1032","3097","3099","1033","3100","3101","3102","3103","3105","3106","3107","1034","1035","3108","3109","3110","3111","3112","3113","3114","3115","3116","3117","3118","3119","3120","3121","5003","3122","3123","3124","3125","3126","3127","1036","1037","3128","3129","3130","3131","3132","1038","3136","1039","3140","1040","3144","1041","3146","3147","3148","3149","1042","3150","1043","3151","3152","1045","3153","1046","3154","3156","3157","3160","3162","3163","3164","3165","1047","3166","3167","1050","5004","5005","1051","1053","5006","1054","1055","1056","1057","3168","3169","1058","2002","1060","2003","3173","3174","1061","3175","3176","3177","1062","5007","3178","1066","1067","1068","1070","3179","3180","3181","1071","1072","3183","3184","1073","1074","1075","1076","5008","1077","1078","1079","3185","3190","3193","3194","3195","3196","3197","1081","1083","3198","1085","1087","1088","1089","1090","1093","1094","1095","2004","1097","1098","2005","1099","5009","1100","1101","1102","1103","1104","1105","2006","2007","5010","2008","2009","1274","2010","1106","2011","2012","1107","1108","1109","1110","1111","1112","1113","1114","2013","1116","1117","1118","1119","1121","1122","1123","1124","1125","1126","1127","1128","1129","1130","1131","1275","1132","1134","1135","1136","1137","1138","1139","1140","1142","1144","1145","1146","1148","1149","1150","1151","1153","5011","2014","1154","1155","1156","1159","2015","2016","1160","1276","1161","1162","1163","1164","1165","1166","1167","1168","1169","1170","1171","1172","1174","1175","1176","1177","1178","1179","1180","1181","1182","1183","1184","1185","2017","4014","2018","2019","1186","2020","5012","1187","1188","2021","1193","1194","4015","1195","1196","1197","2022","1198","1199","1200","2023","1277","1278","2024","1201","1202","1203","1204","1205","1206","1207","1208","1209","1210","1211","1212","1213","1214","1215","1216","1217","1218","1219","1220","1223","1224","1225","1226","1227","1228","1232","1234","1235","1238","1241","1242","1243","1244","1245","2025","1246","1247","1248","1249","1251","1252","1254","1255","1257","1258","1260","1261","1262","1264","3201","3202","3203","3204","3206","3207","3208","3209","1279","1280","1282","1284","2026","2027","1285","1286","1287","1288","1289","1290","1291","1292","1294","1295","1296","1297","1298","1299","1300","1301","1302","1303","1304","1305","1307","1308","1310","1311","1312","2028","1313","1314","1315","1316","2029","2030","3211","1341","1342","1343","1317","1318","1319","1320","1321","1322","1323","1324","1326","3212","3213","3214","3216","3217","3219","3220","1351","1353","1354","1355","1356","1357","1358","1359","1360","1362","1363","1364","1366","1367","1368","1327","1369","1372","1373","1328","1329","1330","1331","1332","1333","1334","1335","1336","1337","1338","1344","1339","1340","1379","1380","1381","1382","1345","1346","1347","1348","1349","1384","1350","1375","1376","1377","5015","5016","1378","1383","1385","1386","1387","1388","5017","1389","1390","1391","1392","1393","5018","1394","1395","1396"];
// var bibArray = ["GOGON","GUGUN"];
io.on('connection', function (socket) {
	socket.on('reset', function (data) {
		io.emit('reset');
		console.log('reset');
	});
	socket.on('start', function (data) {
		io.emit('start',{no:shuffle(bibArray)[0]});
		console.log('start', shuffle(bibArray)[0]);
	});
});

function shuffle(array) {
	var currentIndex = array.length, temporaryValue, randomIndex;

	// While there remain elements to shuffle...
	while (0 !== currentIndex) {

		// Pick a remaining element...
		randomIndex = Math.floor(Math.random() * currentIndex);
		currentIndex -= 1;

		// And swap it with the current element.
		temporaryValue = array[currentIndex];
		array[currentIndex] = array[randomIndex];
		array[randomIndex] = temporaryValue;
	}

	return array;
}